<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
    <link as="style" href="https://fonts.googleapis.com/css2?display=swap&family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&family=Plus+Jakarta+Sans%3Awght%40400%3B500%3B600%3B700%3B800&family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" onload="this.rel='stylesheet'" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <title>NAMS Homestay - Đặt phòng</title>
    <link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style>
        :root {
            --color-nams-white: #FFFFFF;
            --color-nams-beige: #F8F5EE;
            --color-nams-wood-light: #CBAE8B;
            --color-nams-gray-light: #ECECEC;
            --color-nams-gray-dark: #3A3A3A;
            --color-nams-black: #1A1A1A;
            --color-nams-terracotta: #A64B2A;
            --color-nams-terracotta-dark: #7A351E;
            --color-nams-moss-green: #5C7A60;
        }
        .text-nams-terracotta { color: var(--color-nams-terracotta); }
        .bg-nams-terracotta { background-color: var(--color-nams-terracotta); }
        .hover\:bg-nams-terracotta-dark:hover { background-color: var(--color-nams-terracotta-dark); }
        .bg-nams-beige { background-color: var(--color-nams-beige); }
        .text-nams-gray-dark { color: var(--color-nams-gray-dark); }
        .text-nams-black { color: var(--color-nams-black); }
        .btn-primary { background-color: var(--color-nams-terracotta); color: white; padding: 0.75rem 1.5rem; border-radius: 0.375rem; font-weight: 500; display: inline-flex; align-items: center; justify-content: center; transition: background-color 0.2s; }
        .btn-primary:hover { background-color: var(--color-nams-terracotta-dark); }
        .icon-nams-terracotta { color: var(--color-nams-terracotta); }
    </style>
</head>
<body class="bg-nams-beige font-[Plus Jakarta Sans]">
    <div class="relative flex size-full min-h-screen flex-col">
        <header class="sticky top-0 z-50 flex items-center justify-between whitespace-nowrap border-b bg-white/80 px-6 sm:px-10 py-4 shadow-sm backdrop-blur-md">
            <div class="flex items-center gap-3">
                <svg class="w-8 h-8 text-nams-terracotta" fill="none" viewBox="0 0 48 48"><path d="M6 6H42L36 24L42 42H6L12 24L6 6Z" fill="currentColor"></path></svg>
                <h2 class="text-nams-black text-xl font-bold">NAMS Homestay</h2>
            </div>
            <nav class="hidden md:flex items-center gap-x-6">
                <a class="text-nams-gray-dark hover:text-nams-terracotta" href="homepage.html">Trang chủ</a>
                <a class="text-nams-gray-dark hover:text-nams-terracotta" href="room.html">Phòng</a>
                <a class="bg-nams-terracotta hover:bg-nams-terracotta-dark text-white px-4 py-2 rounded" href="booking.html">Đặt phòng</a>
            </nav>
        </header>

        <main class="flex-grow">
            <section class="bg-white py-16">
                <div class="container mx-auto px-4 text-center">
                    <h1 class="text-4xl sm:text-5xl font-extrabold text-nams-black mb-6">Liên hệ & Đặt phòng</h1>
                    <p class="max-w-3xl mx-auto text-nams-gray-dark text-lg">Gửi yêu cầu đặt phòng hoặc liên hệ với chúng tôi.</p>
                </div>
            </section>

            <section class="bg-nams-beige py-16">
                <div class="container mx-auto px-4 grid grid-cols-1 md:grid-cols-2 gap-12">
                    <div class="bg-white p-8 rounded-lg shadow-lg">
                        <h2 class="text-2xl font-bold text-nams-black mb-6">Thông tin liên hệ</h2>
                        <ul class="space-y-6">
                            <li class="flex items-start"><span class="material-icons icon-nams-terracotta text-3xl mr-4">location_on</span><div><strong class="text-nams-black">Địa chỉ:</strong><br/> [Địa chỉ NAMS], Huế</div></li>
                            <li class="flex items-start"><span class="material-icons icon-nams-terracotta text-3xl mr-4">phone</span><div><strong class="text-nams-black">Điện thoại:</strong><br/> <a href="tel:+84123456789" class="text-nams-terracotta hover:underline">[Số điện thoại]</a></div></li>
                            <li class="flex items-start"><span class="material-icons icon-nams-terracotta text-3xl mr-4">email</span><div><strong class="text-nams-black">Email:</strong><br/> <a href="mailto:nams.homestay@email.com" class="text-nams-terracotta hover:underline">nams.homestay@email.com</a></div></li>
                        </ul>
                    </div>

                    <div class="bg-white p-8 rounded-lg shadow-lg">
                        <h2 class="text-2xl font-bold text-nams-black mb-6">Gửi yêu cầu đặt phòng</h2>
                        <form id="booking-form" class="space-y-6">
                            <div><label for="name" class="block text-sm font-medium text-nams-gray-dark mb-2">Họ và tên:</label><input type="text" id="name" name="name" required class="w-full rounded-md border-gray-300"/></div>
                            <div><label for="email" class="block text-sm font-medium text-nams-gray-dark mb-2">Email:</label><input type="email" id="email" name="email" required class="w-full rounded-md border-gray-300"/></div>
                            <div><label for="phone" class="block text-sm font-medium text-nams-gray-dark mb-2">Số điện thoại:</label><input type="tel" id="phone" name="phone" required class="w-full rounded-md border-gray-300"/></div>
                            <div class="grid sm:grid-cols-2 gap-6">
                                <div><label for="check-in" class="block text-sm font-medium text-nams-gray-dark mb-2">Ngày đến:</label><input type="date" id="check-in" name="check_in_date" required class="w-full rounded-md border-gray-300"/></div>
                                <div><label for="check-out" class="block text-sm font-medium text-nams-gray-dark mb-2">Ngày đi:</label><input type="date" id="check-out" name="check_out_date" required class="w-full rounded-md border-gray-300"/></div>
                            </div>
                            <div><label for="room-type" class="block text-sm font-medium text-nams-gray-dark mb-2">Loại phòng muốn đặt:</label><select id="room-type" name="room_type" class="w-full rounded-md border-gray-300"><option value="">Đang tải loại phòng...</option></select></div>
                            <div><label for="message" class="block text-sm font-medium text-nams-gray-dark mb-2">Yêu cầu đặc biệt:</label><textarea id="message" name="message" rows="4" class="w-full rounded-md border-gray-300"></textarea></div>
                            <button type="submit" class="btn-primary w-full">Gửi yêu cầu đặt phòng</button>
                            <div id="form-message" class="mt-4 text-center"></div>
                        </form>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const roomTypeSelect = document.getElementById('room-type');
        const bookingForm = document.getElementById('booking-form');
        const formMessage = document.getElementById('form-message');
        const apiUrl = 'http://localhost:3000'; // Base API URL

        // 1. Tải danh sách các loại phòng và điền vào dropdown
        fetch(`${apiUrl}/api/phong/with-prices`)
            .then(response => response.json())
            .then(data => {
                roomTypeSelect.innerHTML = '<option value="">-- Chọn loại phòng --</option>';
                const roomTypes = {
                    'E': 'Economy',
                    'S': 'Second-class',
                    'F': 'First-class'
                };
                // Dùng Set để chỉ lấy các hạng phòng duy nhất
                const uniqueHangPhong = [...new Set(data.map(phong => phong.HangPhong))];
                
                uniqueHangPhong.forEach(hang => {
                    const option = document.createElement('option');
                    // Map 'E' to 'economy', 'S' to 'second-class', etc.
                    const valueMap = { 'E': 'economy', 'S': 'second-class', 'F': 'first-class' };
                    option.value = valueMap[hang];
                    option.textContent = roomTypes[hang] || hang; // Show descriptive name
                    roomTypeSelect.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Lỗi tải loại phòng:', error);
                roomTypeSelect.innerHTML = '<option value="">Không thể tải loại phòng</option>';
            });

        // 2. Xử lý việc gửi form
        bookingForm.addEventListener('submit', function(event) {
            event.preventDefault(); // Ngăn form gửi theo cách truyền thống
            formMessage.textContent = 'Đang gửi yêu cầu...';
            formMessage.className = 'text-center text-gray-600';

            const formData = new FormData(bookingForm);
            const data = Object.fromEntries(formData.entries());

            // Gửi dữ liệu đến API
            fetch(`${apiUrl}/api/booking`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    formMessage.className = 'text-center text-green-600';
                    formMessage.textContent = `${result.message} Mã đặt phòng của bạn là: ${result.bookingId}`;
                    bookingForm.reset();
                } else {
                    throw new Error(result.error || result.message || 'Một lỗi không xác định đã xảy ra.');
                }
            })
            .catch(error => {
                console.error('Lỗi khi gửi yêu cầu đặt phòng:', error);
                formMessage.className = 'text-center text-red-600';
                formMessage.textContent = `Lỗi: ${error.message}`;
            });
        });
    });
    </script>
</body>
</html>